import{_ as i,c as a,o as n,ae as l}from"./chunks/framework.BBQ6_s69.js";const g=JSON.parse('{"title":"BGE-M3模型与LangChain知识库系统集成指南","description":"","frontmatter":{},"headers":[],"relativePath":"developer-guide/integration-guide.md","filePath":"developer-guide/integration-guide.md","lastUpdated":1756197408000}'),t={name:"developer-guide/integration-guide.md"};function h(e,s,p,k,r,o){return n(),a("div",null,s[0]||(s[0]=[l(`<h1 id="bge-m3模型与langchain知识库系统集成指南" tabindex="-1">BGE-M3模型与LangChain知识库系统集成指南 <a class="header-anchor" href="#bge-m3模型与langchain知识库系统集成指南" aria-label="Permalink to &quot;BGE-M3模型与LangChain知识库系统集成指南&quot;">​</a></h1><h2 id="🎯-系统概述" tabindex="-1">🎯 系统概述 <a class="header-anchor" href="#🎯-系统概述" aria-label="Permalink to &quot;🎯 系统概述&quot;">​</a></h2><p>您的知识库系统已成功集成BGE-M3嵌入模型和LangChain，具备以下特性：</p><ul><li>✅ <strong>BGE-M3多语言嵌入模型</strong>: 支持中文+100多种语言，1024维向量</li><li>✅ <strong>ChromaDB向量存储</strong>: 高性能本地向量数据库</li><li>✅ <strong>LangChain集成</strong>: 标准化的文档处理和检索流程</li><li>✅ <strong>LangGraph对话系统</strong>: 支持RAG增强的智能对话</li><li>✅ <strong>MCP工具集成</strong>: 可与外部工具无缝协作</li></ul><h2 id="🚀-快速开始" tabindex="-1">🚀 快速开始 <a class="header-anchor" href="#🚀-快速开始" aria-label="Permalink to &quot;🚀 快速开始&quot;">​</a></h2><h3 id="_1-系统状态检查" tabindex="-1">1. 系统状态检查 <a class="header-anchor" href="#_1-系统状态检查" aria-label="Permalink to &quot;1. 系统状态检查&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查嵌入模型和依赖</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> check_embedding_models.py</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查Django知识库系统</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> manage.py</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> check_knowledge_system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --verbose</span></span></code></pre></div><h3 id="_2-创建知识库" tabindex="-1">2. 创建知识库 <a class="header-anchor" href="#_2-创建知识库" aria-label="Permalink to &quot;2. 创建知识库&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 通过API创建知识库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /api/knowledge/knowledge-bases/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;name&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;技术文档库&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;description&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;存储技术文档和API说明&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;project&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;embedding_model&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;BAAI/bge-m3&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;chunk_size&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1000,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;chunk_overlap&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-上传文档" tabindex="-1">3. 上传文档 <a class="header-anchor" href="#_3-上传文档" aria-label="Permalink to &quot;3. 上传文档&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 上传文档到知识库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /api/knowledge/documents/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;knowledge_base&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;title&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;API文档&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;document_type&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;pdf&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;file&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">文件上</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">传</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="📋-核心api接口" tabindex="-1">📋 核心API接口 <a class="header-anchor" href="#📋-核心api接口" aria-label="Permalink to &quot;📋 核心API接口&quot;">​</a></h2><h3 id="知识库管理" tabindex="-1">知识库管理 <a class="header-anchor" href="#知识库管理" aria-label="Permalink to &quot;知识库管理&quot;">​</a></h3><h4 id="创建知识库" tabindex="-1">创建知识库 <a class="header-anchor" href="#创建知识库" aria-label="Permalink to &quot;创建知识库&quot;">​</a></h4><ul><li><strong>接口</strong>: <code>POST /api/knowledge/knowledge-bases/</code></li><li><strong>说明</strong>: 创建新的知识库，自动使用BGE-M3模型</li></ul><h4 id="查询知识库" tabindex="-1">查询知识库 <a class="header-anchor" href="#查询知识库" aria-label="Permalink to &quot;查询知识库&quot;">​</a></h4><ul><li><strong>接口</strong>: <code>POST /api/knowledge/knowledge-bases/{id}/query/</code></li><li><strong>参数</strong>:<div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;query&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;查询文本&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;top_k&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;similarity_threshold&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.7</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li></ul><h4 id="系统状态检查" tabindex="-1">系统状态检查 <a class="header-anchor" href="#系统状态检查" aria-label="Permalink to &quot;系统状态检查&quot;">​</a></h4><ul><li><strong>接口</strong>: <code>GET /api/knowledge/knowledge-bases/system_status/</code></li><li><strong>说明</strong>: 检查嵌入模型、依赖库、向量存储状态</li></ul><h3 id="langgraph对话集成" tabindex="-1">LangGraph对话集成 <a class="header-anchor" href="#langgraph对话集成" aria-label="Permalink to &quot;LangGraph对话集成&quot;">​</a></h3><h4 id="rag增强对话" tabindex="-1">RAG增强对话 <a class="header-anchor" href="#rag增强对话" aria-label="Permalink to &quot;RAG增强对话&quot;">​</a></h4><ul><li><strong>接口</strong>: <code>POST /api/langgraph/chat/</code></li><li><strong>参数</strong>:<div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;用户消息&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;project_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;项目ID&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;knowledge_base_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;知识库ID&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;use_knowledge_base&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;similarity_threshold&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;top_k&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li></ul><h2 id="🔧-技术架构" tabindex="-1">🔧 技术架构 <a class="header-anchor" href="#🔧-技术架构" aria-label="Permalink to &quot;🔧 技术架构&quot;">​</a></h2><h3 id="嵌入模型层" tabindex="-1">嵌入模型层 <a class="header-anchor" href="#嵌入模型层" aria-label="Permalink to &quot;嵌入模型层&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>BGE-M3 (BAAI/bge-m3)</span></span>
<span class="line"><span>├── 多语言支持 (中文+100+语言)</span></span>
<span class="line"><span>├── 1024维向量</span></span>
<span class="line"><span>├── 本地缓存 (.cache/huggingface/)</span></span>
<span class="line"><span>└── LangChain HuggingFaceEmbeddings 封装</span></span></code></pre></div><h3 id="向量存储层" tabindex="-1">向量存储层 <a class="header-anchor" href="#向量存储层" aria-label="Permalink to &quot;向量存储层&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ChromaDB</span></span>
<span class="line"><span>├── 本地持久化存储</span></span>
<span class="line"><span>├── 按知识库隔离 (collection_name: kb_{id})</span></span>
<span class="line"><span>├── 自动权限管理</span></span>
<span class="line"><span>└── 相似度搜索优化</span></span></code></pre></div><h3 id="应用层" tabindex="-1">应用层 <a class="header-anchor" href="#应用层" aria-label="Permalink to &quot;应用层&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Django REST API</span></span>
<span class="line"><span>├── 知识库CRUD</span></span>
<span class="line"><span>├── 文档上传处理</span></span>
<span class="line"><span>├── 向量化管道</span></span>
<span class="line"><span>└── 查询检索接口</span></span></code></pre></div><h3 id="对话层" tabindex="-1">对话层 <a class="header-anchor" href="#对话层" aria-label="Permalink to &quot;对话层&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>LangGraph集成</span></span>
<span class="line"><span>├── RAG增强对话</span></span>
<span class="line"><span>├── 知识库工具调用</span></span>
<span class="line"><span>├── 多轮对话支持</span></span>
<span class="line"><span>└── MCP工具集成</span></span></code></pre></div><h2 id="🛠️-配置说明" tabindex="-1">🛠️ 配置说明 <a class="header-anchor" href="#🛠️-配置说明" aria-label="Permalink to &quot;🛠️ 配置说明&quot;">​</a></h2><h3 id="环境变量" tabindex="-1">环境变量 <a class="header-anchor" href="#环境变量" aria-label="Permalink to &quot;环境变量&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .env 文件配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HF_HOME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.cache/huggingface</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HF_HUB_CACHE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.cache/huggingface</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SENTENCE_TRANSFORMERS_HOME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.cache/huggingface</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HF_HUB_OFFLINE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TRANSFORMERS_OFFLINE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span></span></code></pre></div><h3 id="模型配置" tabindex="-1">模型配置 <a class="header-anchor" href="#模型配置" aria-label="Permalink to &quot;模型配置&quot;">​</a></h3><ul><li><strong>模型名称</strong>: <code>BAAI/bge-m3</code></li><li><strong>缓存位置</strong>: <code>.cache/huggingface/</code></li><li><strong>设备</strong>: CPU (兼容性最佳)</li><li><strong>向量维度</strong>: 1024</li><li><strong>归一化</strong>: 启用</li></ul><h3 id="分块配置" tabindex="-1">分块配置 <a class="header-anchor" href="#分块配置" aria-label="Permalink to &quot;分块配置&quot;">​</a></h3><ul><li><strong>默认分块大小</strong>: 1000字符</li><li><strong>重叠大小</strong>: 200字符</li><li><strong>文本分割器</strong>: RecursiveCharacterTextSplitter</li></ul><h2 id="📊-性能指标" tabindex="-1">📊 性能指标 <a class="header-anchor" href="#📊-性能指标" aria-label="Permalink to &quot;📊 性能指标&quot;">​</a></h2><h3 id="模型性能" tabindex="-1">模型性能 <a class="header-anchor" href="#模型性能" aria-label="Permalink to &quot;模型性能&quot;">​</a></h3><ul><li><strong>加载时间</strong>: ~5秒 (首次)</li><li><strong>编码速度</strong>: ~1000字符/秒</li><li><strong>内存占用</strong>: ~2.2GB</li><li><strong>磁盘占用</strong>: ~8.5GB</li></ul><h3 id="检索性能" tabindex="-1">检索性能 <a class="header-anchor" href="#检索性能" aria-label="Permalink to &quot;检索性能&quot;">​</a></h3><ul><li><strong>单次查询</strong>: &lt;100ms</li><li><strong>批量检索</strong>: &lt;500ms</li><li><strong>相似度计算</strong>: 余弦距离</li><li><strong>缓存命中</strong>: &gt;90%</li></ul><h2 id="🔍-使用示例" tabindex="-1">🔍 使用示例 <a class="header-anchor" href="#🔍-使用示例" aria-label="Permalink to &quot;🔍 使用示例&quot;">​</a></h2><h3 id="python代码示例" tabindex="-1">Python代码示例 <a class="header-anchor" href="#python代码示例" aria-label="Permalink to &quot;Python代码示例&quot;">​</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 直接使用知识库服务</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> knowledge.services </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KnowledgeBaseService</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> knowledge.models </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KnowledgeBase</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KnowledgeBase.objects.get(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">service </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KnowledgeBaseService(kb)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> service.query(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    query_text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;什么是API接口？&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    similarity_threshold</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.7</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 使用LangGraph RAG服务</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> knowledge.langgraph_integration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ConversationalRAGService</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langchain_openai </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChatOpenAI</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">llm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChatOpenAI(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;your-key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">base_url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;your-url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rag_service </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ConversationalRAGService(llm)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rag_service.query(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    question</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;如何使用这个API？&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    knowledge_base_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    use_knowledge_base</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="api调用示例" tabindex="-1">API调用示例 <a class="header-anchor" href="#api调用示例" aria-label="Permalink to &quot;API调用示例&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查询知识库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:8000/api/knowledge/knowledge-bases/1/query/&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer your-token&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;query&quot;: &quot;什么是BGE-M3模型？&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;top_k&quot;: 3,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;similarity_threshold&quot;: 0.6</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  }&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># RAG对话</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:8000/api/langgraph/chat/&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Authorization: Bearer your-token&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;message&quot;: &quot;请解释一下这个技术的原理&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;project_id&quot;: &quot;1&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;knowledge_base_id&quot;: &quot;1&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;use_knowledge_base&quot;: true</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  }&#39;</span></span></code></pre></div><h2 id="🚨-故障排除" tabindex="-1">🚨 故障排除 <a class="header-anchor" href="#🚨-故障排除" aria-label="Permalink to &quot;🚨 故障排除&quot;">​</a></h2><h3 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h3><ol><li><p><strong>模型未下载</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> download_embedding_models.py</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --download</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bge-m3</span></span></code></pre></div></li><li><p><strong>依赖库缺失</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> langchain-huggingface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> langchain-chroma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sentence-transformers</span></span></code></pre></div></li><li><p><strong>权限问题</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> manage.py</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> check_knowledge_system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --fix</span></span></code></pre></div></li><li><p><strong>向量存储损坏</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> knowledge.services </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VectorStoreManager</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VectorStoreManager.clear_cache(knowledge_base_id)</span></span></code></pre></div></li></ol><h3 id="日志监控" tabindex="-1">日志监控 <a class="header-anchor" href="#日志监控" aria-label="Permalink to &quot;日志监控&quot;">​</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> logging</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logging.getLogger(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;knowledge&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).setLevel(logging.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INFO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="📈-扩展功能" tabindex="-1">📈 扩展功能 <a class="header-anchor" href="#📈-扩展功能" aria-label="Permalink to &quot;📈 扩展功能&quot;">​</a></h2><h3 id="自定义嵌入模型" tabindex="-1">自定义嵌入模型 <a class="header-anchor" href="#自定义嵌入模型" aria-label="Permalink to &quot;自定义嵌入模型&quot;">​</a></h3><ul><li>修改 <code>knowledge/models.py</code> 中的 <code>embedding_model</code> 字段</li><li>更新 <code>VectorStoreManager</code> 中的模型加载逻辑</li></ul><h3 id="多向量存储支持" tabindex="-1">多向量存储支持 <a class="header-anchor" href="#多向量存储支持" aria-label="Permalink to &quot;多向量存储支持&quot;">​</a></h3><ul><li>实现新的向量存储管理器</li><li>继承 <code>VectorStoreManager</code> 基类</li></ul><h3 id="高级rag功能" tabindex="-1">高级RAG功能 <a class="header-anchor" href="#高级rag功能" aria-label="Permalink to &quot;高级RAG功能&quot;">​</a></h3><ul><li>实现混合检索 (关键词+向量)</li><li>添加重排序模型</li><li>支持多模态嵌入</li></ul><h2 id="🎉-总结" tabindex="-1">🎉 总结 <a class="header-anchor" href="#🎉-总结" aria-label="Permalink to &quot;🎉 总结&quot;">​</a></h2><p>您的BGE-M3模型与LangChain知识库系统已完全集成并正常运行！系统具备：</p><ul><li>🚀 <strong>高性能</strong>: BGE-M3多语言嵌入模型</li><li>🔧 <strong>易用性</strong>: 标准化API接口</li><li>🛡️ <strong>稳定性</strong>: 完善的错误处理和监控</li><li>🔄 <strong>可扩展</strong>: 模块化架构设计</li></ul><p>现在您可以开始创建知识库、上传文档，并享受智能的RAG对话体验！</p>`,64)]))}const c=i(t,[["render",h]]);export{g as __pageData,c as default};
